[{"filePath":"C:\\Atharv\\Git\\careflow\\careflow-copilot\\app\\api\\forecast\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Atharv\\Git\\careflow\\careflow-copilot\\app\\api\\metrics\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Atharv\\Git\\careflow\\careflow-copilot\\app\\api\\note-extract\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":87,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3078,3081],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3078,3081],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":88,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3154,3157],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3154,3157],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport OpenAI from \"openai\";\r\nimport { z } from \"zod\";\r\nimport { initLogger, wrapOpenAI } from \"braintrust\";\r\nimport { zodResponseFormat } from \"openai/helpers/zod\";\r\nimport { NoteExtractSchema } from \"../../../lib/llm/schema\";\r\nimport { buildSystemPrompt, buildUserPrompt, PROMPT_VERSION } from \"../../../lib/llm/prompt\";\r\n\r\nexport const runtime = \"nodejs\";\r\n\r\nconst RequestSchema = z.object({\r\n    note: z.string().min(50).max(8000),\r\n});\r\n\r\nconst RATE_LIMIT_WINDOW_MS = 5 * 60 * 1000;\r\nconst RATE_LIMIT_MAX = 10;\r\nconst rateLimits = new Map<string, { count: number; resetTime: number }>();\r\n\r\nfunction checkRateLimit(ip: string) {\r\n    const now = Date.now();\r\n    let data = rateLimits.get(ip);\r\n\r\n    if (!data || now > data.resetTime) {\r\n        data = { count: 1, resetTime: now + RATE_LIMIT_WINDOW_MS };\r\n        rateLimits.set(ip, data);\r\n        return { limitReached: false };\r\n    }\r\n\r\n    data.count++;\r\n\r\n    if (data.count > RATE_LIMIT_MAX) {\r\n        const retryAfterSeconds = Math.ceil((data.resetTime - now) / 1000);\r\n        return { limitReached: true, retryAfter: retryAfterSeconds };\r\n    }\r\n\r\n    return { limitReached: false };\r\n}\r\n\r\nexport async function POST(req: Request) {\r\n    const startTime = Date.now();\r\n    try {\r\n        const ip = req.headers.get(\"x-forwarded-for\") || \"127.0.0.1\";\r\n        const { limitReached, retryAfter } = checkRateLimit(ip);\r\n        if (limitReached) {\r\n            return NextResponse.json(\r\n                { error: { code: \"rate_limited\", message: \"Too many requests. Please try again later.\" } },\r\n                { status: 429, headers: { \"Retry-After\": String(retryAfter) } }\r\n            );\r\n        }\r\n\r\n        const body = await req.json();\r\n        const parsedBody = RequestSchema.safeParse(body);\r\n        if (!parsedBody.success) {\r\n            return NextResponse.json(\r\n                { error: { code: \"invalid_request\", message: \"Invalid request. Note must be between 50 and 8000 characters.\" } },\r\n                { status: 400 }\r\n            );\r\n        }\r\n\r\n        const note = parsedBody.data.note;\r\n\r\n        if (!process.env.OPENAI_API_KEY) {\r\n            return NextResponse.json(\r\n                { error: { code: \"missing_api_key\", message: \"OpenAI API key is missing. Please configure OPENAI_API_KEY in your environment.\" } },\r\n                { status: 500 }\r\n            );\r\n        }\r\n\r\n        console.log(`[NoteExtract API] Processing note of length: ${note.length}`);\r\n\r\n        // Initialize the Braintrust logger and wrap the OpenAI client per documentation\r\n        const logger = initLogger({\r\n            projectName: \"careflow-copilot\",\r\n            apiKey: process.env.BRAINTRUST_API_KEY,\r\n        });\r\n\r\n        // wrapOpenAI() automatically captures all AI calls as traces\r\n        const client = wrapOpenAI(\r\n            new OpenAI({\r\n                apiKey: process.env.OPENAI_API_KEY,\r\n            }),\r\n        );\r\n\r\n        let completion;\r\n\r\n        // Try paths commonly used for Structured Outputs\r\n        if ((client as any).chat?.completions?.parse) {\r\n            completion = await (client as any).chat.completions.parse({\r\n                model: \"gpt-4o-mini\",\r\n                messages: [\r\n                    { role: \"system\", content: buildSystemPrompt() },\r\n                    { role: \"user\", content: buildUserPrompt(note) },\r\n                ],\r\n                response_format: zodResponseFormat(NoteExtractSchema, \"note_extract\"),\r\n                temperature: 0.2,\r\n                store: false,\r\n            });\r\n        } else {\r\n            throw new Error(\"OpenAI SDK version does not support structured output '.parse()' helper.\");\r\n        }\r\n\r\n        const result = completion.choices[0].message.parsed;\r\n        if (!result) {\r\n            throw new Error(\"Failed to parse the response structure from OpenAI.\");\r\n        }\r\n\r\n        // You can also use logger.log() for custom traces (e.g., multimodal inputs, metadata)\r\n        // We omit raw note content to preserve PHI safety bounds\r\n        logger.log({\r\n            input: \"Redacted note for extraction\",\r\n            output: \"Schema populated successfully\",\r\n            metadata: {\r\n                prompt_version: PROMPT_VERSION,\r\n                note_length_chars: note.length,\r\n                model: completion.model || \"gpt-4o-mini\",\r\n                red_flags_count: result.redFlags.length,\r\n                success: true,\r\n                latency_ms: Date.now() - startTime,\r\n            },\r\n        });\r\n\r\n        return NextResponse.json({\r\n            prompt_version: PROMPT_VERSION,\r\n            model: completion.model || \"gpt-4o-mini\",\r\n            result: result,\r\n        });\r\n    } catch (error: unknown) {\r\n        const errObj = error as {\r\n            name?: string,\r\n            status?: number,\r\n            message?: string,\r\n            request_id?: string,\r\n            code?: string,\r\n            type?: string\r\n        };\r\n\r\n        // If it failed, log the error failure to braintrust too\r\n        const logger = initLogger({\r\n            projectName: \"careflow-copilot\",\r\n            apiKey: process.env.BRAINTRUST_API_KEY,\r\n        });\r\n        logger.log({\r\n            input: \"Failed note extraction\",\r\n            output: errObj.message || \"Unknown error\",\r\n            metadata: {\r\n                success: false,\r\n                latency_ms: Date.now() - startTime,\r\n            }\r\n        });\r\n\r\n        console.error(\"[NoteExtract API] Error:\", errObj);\r\n\r\n        // Specific handling for common OpenAI account issues\r\n        if (errObj.code === 'insufficient_quota') {\r\n            return NextResponse.json(\r\n                {\r\n                    error: {\r\n                        code: \"insufficient_quota\",\r\n                        message: \"The API key has insufficient credits or has reached its quota. Even for new accounts, OpenAI requires a minimum prepaid balance (usually $5) to activate the API. Please check your billing dashboard: https://platform.openai.com/settings/organization/billing\"\r\n                    }\r\n                },\r\n                { status: 402 } // Payment Required / Quota Exceeded\r\n            );\r\n        }\r\n\r\n        if (errObj.status === 401) {\r\n            return NextResponse.json(\r\n                {\r\n                    error: {\r\n                        code: \"unauthorized\",\r\n                        message: \"The API key in .env.local is either invalid or lacks the necessary permissions. If using a 'Project API Key', ensure it has 'Read/Write' access to the Chat model in your OpenAI Project settings.\"\r\n                    }\r\n                },\r\n                { status: 401 }\r\n            );\r\n        }\r\n\r\n        // Check if it's an OpenAI API error regarding parsing or similar issue\r\n        if (errObj.name === 'LengthFinishReasonError' || errObj.status === 402 || errObj.status === 400 || errObj.message?.includes('parse')) {\r\n            return NextResponse.json(\r\n                {\r\n                    error: {\r\n                        code: \"parse_error\",\r\n                        message: errObj.message || \"Failed to parse OpenAI structure.\"\r\n                    }\r\n                },\r\n                { status: 502 }\r\n            );\r\n        }\r\n\r\n        return NextResponse.json(\r\n            {\r\n                error: {\r\n                    code: errObj.code || \"internal_error\",\r\n                    message: errObj.message || \"An unexpected error occurred during note analysis.\"\r\n                }\r\n            },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Atharv\\Git\\careflow\\careflow-copilot\\app\\dashboard\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Atharv\\Git\\careflow\\careflow-copilot\\app\\forecast\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Atharv\\Git\\careflow\\careflow-copilot\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Atharv\\Git\\careflow\\careflow-copilot\\app\\note-analyzer\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":91,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3035,3038],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3035,3038],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":229,"column":53,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[11577,11632],"text":"\r\n                                                    &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[11577,11632],"text":"\r\n                                                    &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[11577,11632],"text":"\r\n                                                    &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[11577,11632],"text":"\r\n                                                    &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":229,"column":69,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[11647,11698],"text":"&quot;\r\n                                                "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[11647,11698],"text":"&ldquo;\r\n                                                "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[11647,11698],"text":"&#34;\r\n                                                "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[11647,11698],"text":"&rdquo;\r\n                                                "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":289,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":289,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14891,14894],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14891,14894],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useState } from \"react\";\r\nimport {\r\n    Brain,\r\n    Clipboard,\r\n    Zap,\r\n    Activity,\r\n    AlertTriangle,\r\n    Pill,\r\n    Thermometer,\r\n    Calendar,\r\n    ChevronDown,\r\n    ChevronRight,\r\n    Search,\r\n    Loader2,\r\n    CheckCircle2,\r\n    XCircle,\r\n    ArrowRight,\r\n    RefreshCw,\r\n} from \"lucide-react\";\r\n\r\n// Types derived from schema\r\ninterface NoteExtractResult {\r\n    summary: string;\r\n    problems: { label: string; evidence: string }[];\r\n    medications: { label: string; evidence: string }[];\r\n    allergies: { label: string; evidence: string }[];\r\n    followUps: { label: string; evidence: string }[];\r\n    redFlags: { label: string; severity: \"low\" | \"medium\" | \"high\"; evidence: string }[];\r\n}\r\n\r\ninterface NoteExtractResponse {\r\n    prompt_version: string;\r\n    model: string;\r\n    result: NoteExtractResult;\r\n}\r\n\r\nconst SAMPLE_NOTE = `\r\nCHIEF COMPLAINT: Patient presents with persistent headache and mild nausea for the past 3 days.\r\n\r\nHPI: 45-year-old male reporting a throbbing, bifrontal headache that started 3 days ago. He rates the pain as 6/10. He also complains of mild intermittent nausea, but no vomiting. He denies visual changes, fever, neck stiffness, or weakness. He reports taking over-the-counter Ibuprofen 400mg with minimal relief. \r\n\r\nPAST MEDICAL HISTORY:\r\n- Hypertension\r\n\r\nMEDICATIONS:\r\n- Lisinopril 10mg daily\r\n- Ibuprofen 400mg PRN for pain\r\n\r\nALLERGIES:\r\n- Penicillin (causes hives)\r\n\r\nASSESSMENT & PLAN:\r\n1. Tension-type headache. Recommended rest, hydration, and adjusting pain management to Acetaminophen. \r\n2. Nausea: likely related to headache. Recommended small, frequent meals.\r\n3. Hypertension: well controlled. Continue current Lisinopril.\r\n4. Red flag screen negative. If symptoms worsen, develop visual changes, or neck stiffness, patient should seek immediate emergency care (High severity potential if missed).\r\n5. Follow up in clinic in 1 week if no improvement.\r\n`;\r\n\r\nexport default function NoteAnalyzerPage() {\r\n    const [note, setNote] = useState(\"\");\r\n    const [loading, setLoading] = useState(false);\r\n    const [response, setResponse] = useState<NoteExtractResponse | null>(null);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [jsonOpen, setJsonOpen] = useState(false);\r\n\r\n    const handleExtract = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!note.trim()) return;\r\n\r\n        setLoading(true);\r\n        setResponse(null);\r\n        setError(null);\r\n\r\n        try {\r\n            const res = await fetch(\"/api/note-extract\", {\r\n                method: \"POST\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify({ note }),\r\n            });\r\n\r\n            if (!res.ok) {\r\n                const errData = await res.json();\r\n                throw new Error(errData.error || errData.message || \"Failed to analyze note\");\r\n            }\r\n\r\n            const data = await res.json();\r\n            setResponse(data);\r\n        } catch (err: any) {\r\n            setError(err.message);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const loadSample = () => setNote(SAMPLE_NOTE.trim());\r\n\r\n    return (\r\n        <div className=\"max-w-6xl mx-auto space-y-12 pb-24 animate-in fade-in duration-700\">\r\n            {/* Header Section */}\r\n            <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-6 px-2\">\r\n                <div>\r\n                    <div className=\"flex items-center gap-3 mb-2\">\r\n                        <div className=\"bg-indigo-600 p-2.5 rounded-2xl shadow-lg shadow-indigo-100\">\r\n                            <Brain className=\"h-6 w-6 text-white\" />\r\n                        </div>\r\n                        <h1 className=\"text-3xl font-extrabold tracking-tight text-slate-900 md:text-4xl\">\r\n                            Intelligent Note Analyzer\r\n                        </h1>\r\n                    </div>\r\n                    <p className=\"text-slate-500 text-lg\">\r\n                        Transform raw clinical shorthand into structured, actionable insights.\r\n                    </p>\r\n                </div>\r\n                <button\r\n                    onClick={loadSample}\r\n                    className=\"flex items-center gap-2 text-indigo-600 font-semibold hover:text-indigo-700 transition-colors bg-indigo-50 px-5 py-2.5 rounded-xl border border-indigo-100 w-fit self-start md:self-center\"\r\n                >\r\n                    <Clipboard className=\"h-4 w-4\" />\r\n                    Load Sample Note\r\n                </button>\r\n            </div>\r\n\r\n            {/* Input Section */}\r\n            <section className=\"bg-white rounded-3xl border border-slate-200 shadow-xl overflow-hidden relative group transition-all hover:shadow-2xl\">\r\n                <div className=\"absolute top-0 inset-x-0 h-1.5 bg-gradient-to-r from-indigo-500 via-blue-500 to-indigo-500\" />\r\n                <form onSubmit={handleExtract} className=\"p-8 space-y-6\">\r\n                    <div className=\"relative\">\r\n                        <textarea\r\n                            value={note}\r\n                            onChange={(e) => setNote(e.target.value)}\r\n                            placeholder=\"Paste practitioner notes, SOAP entries, or clinical observations here... (min 50 characters)\"\r\n                            className=\"w-full min-h-[280px] p-6 text-slate-800 placeholder:text-slate-400 bg-slate-50 border-none rounded-2xl focus:ring-2 focus:ring-indigo-500 focus:bg-white transition-all text-lg leading-relaxed resize-y\"\r\n                            disabled={loading}\r\n                        />\r\n                        <div className=\"absolute bottom-4 right-4 text-xs font-semibold text-slate-400\">\r\n                            {note.length} characters\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"flex flex-col md:flex-row items-center justify-between gap-6\">\r\n                        <div className=\"flex items-center gap-3 text-slate-500 text-sm italic\">\r\n                            <Search className=\"h-4 w-4\" />\r\n                            Analyzing for problems, medications, red flags, and more.\r\n                        </div>\r\n                        <button\r\n                            type=\"submit\"\r\n                            disabled={loading || note.length < 50}\r\n                            className=\"w-full md:w-auto px-10 py-4 bg-slate-900 text-white rounded-2xl font-bold shadow-lg shadow-slate-200 hover:bg-slate-800 hover:translate-y-[-2px] active:translate-y-0 transition-all disabled:opacity-50 disabled:cursor-not-allowed disabled:translate-y-0 flex items-center justify-center gap-3 text-lg\"\r\n                        >\r\n                            {loading ? (\r\n                                <>\r\n                                    <Loader2 className=\"h-5 w-5 animate-spin\" />\r\n                                    Extracting...\r\n                                </>\r\n                            ) : (\r\n                                <>\r\n                                    <Zap className=\"h-5 w-5 fill-indigo-300 text-indigo-300\" />\r\n                                    Analyze Note\r\n                                </>\r\n                            )}\r\n                        </button>\r\n                    </div>\r\n                </form>\r\n            </section>\r\n\r\n            {/* Error Message */}\r\n            {error && (\r\n                <div className=\"bg-rose-50 border border-rose-100 rounded-2xl p-6 flex items-start gap-4 animate-in slide-in-from-top-2\">\r\n                    <XCircle className=\"h-6 w-6 text-rose-500 mt-1 flex-shrink-0\" />\r\n                    <div>\r\n                        <h4 className=\"text-rose-900 font-bold mb-1\">Analysis Engineering Error</h4>\r\n                        <p className=\"text-rose-700\">{error}</p>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Results Section */}\r\n            {response && (\r\n                <div className=\"space-y-8 animate-in fade-in slide-in-from-bottom-8 duration-700\">\r\n                    {/* Summary & Red Flags */}\r\n                    <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n                        {/* Summary Column */}\r\n                        <div className=\"lg:col-span-2 space-y-8\">\r\n                            <div className=\"bg-white p-8 rounded-3xl border border-slate-200 shadow-sm\">\r\n                                <h3 className=\"text-xl font-bold text-slate-900 mb-6 flex items-center gap-2\">\r\n                                    <Activity className=\"h-5 w-5 text-indigo-500\" />\r\n                                    Clinical Summary\r\n                                </h3>\r\n                                <p className=\"text-slate-700 text-lg leading-relaxed\">\r\n                                    {response.result.summary}\r\n                                </p>\r\n                            </div>\r\n\r\n                            <TabsSection result={response.result} />\r\n                        </div>\r\n\r\n                        {/* Red Flags Column */}\r\n                        <div className=\"space-y-8\">\r\n                            <div className=\"bg-slate-900 text-white p-8 rounded-3xl shadow-xl shadow-slate-200 relative overflow-hidden group\">\r\n                                <div className=\"absolute top-0 right-0 p-8 opacity-10 group-hover:opacity-20 transition-opacity\">\r\n                                    <AlertTriangle className=\"h-24 w-24\" />\r\n                                </div>\r\n                                <h3 className=\"text-xl font-extrabold mb-6 flex items-center gap-2 relative z-10\">\r\n                                    <Thermometer className=\"h-5 w-5 text-rose-400\" />\r\n                                    Safety Red Flags\r\n                                </h3>\r\n\r\n                                {response.result.redFlags.length === 0 ? (\r\n                                    <div className=\"bg-white/10 p-5 rounded-2xl flex items-center gap-3 relative z-10\">\r\n                                        <CheckCircle2 className=\"h-5 w-5 text-emerald-400\" />\r\n                                        <span className=\"text-slate-100 font-medium\">No acute warnings detected.</span>\r\n                                    </div>\r\n                                ) : (\r\n                                    <div className=\"space-y-4 relative z-10\">\r\n                                        {response.result.redFlags.map((flag, idx) => (\r\n                                            <div key={idx} className=\"bg-white/10 p-5 rounded-2xl border border-white/5 space-y-3\">\r\n                                                <div className=\"flex items-center justify-between\">\r\n                                                    <span className=\"font-bold text-slate-100\">{flag.label}</span>\r\n                                                    <span className={`px-2 py-0.5 rounded-full text-[10px] uppercase font-black ${flag.severity === 'high' ? 'bg-rose-500' :\r\n                                                            flag.severity === 'medium' ? 'bg-amber-500' : 'bg-slate-500'\r\n                                                        }`}>\r\n                                                        {flag.severity}\r\n                                                    </span>\r\n                                                </div>\r\n                                                <p className=\"text-xs text-slate-300 italic leading-relaxed\">\r\n                                                    \"{flag.evidence}\"\r\n                                                </p>\r\n                                            </div>\r\n                                        ))}\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n\r\n                            <div className=\"bg-white p-8 rounded-3xl border border-slate-200 shadow-sm flex flex-col items-center justify-center text-center gap-4 py-12\">\r\n                                <div className=\"bg-indigo-50 p-4 rounded-full\">\r\n                                    <RefreshCw className=\"h-6 w-6 text-indigo-600\" />\r\n                                </div>\r\n                                <h5 className=\"font-bold text-slate-900\">Deterministic Model</h5>\r\n                                <p className=\"text-sm text-slate-500\">\r\n                                    Parsed via {response.model}<br />\r\n                                    using Prompt Engineering {response.prompt_version}\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Full JSON Viewer */}\r\n                    <div className=\"border-t border-slate-100 pt-8\">\r\n                        <button\r\n                            onClick={() => setJsonOpen(!jsonOpen)}\r\n                            className=\"flex items-center gap-2 text-slate-400 hover:text-slate-600 text-sm font-semibold mb-4 transition-colors ml-auto\"\r\n                        >\r\n                            {jsonOpen ? <ChevronDown className=\"h-4 w-4\" /> : <ChevronRight className=\"h-4 w-4\" />}\r\n                            {jsonOpen ? 'Hide' : 'View'} Internal Extraction JSON\r\n                        </button>\r\n                        {jsonOpen && (\r\n                            <pre className=\"bg-slate-900 text-indigo-200 p-8 rounded-3xl overflow-x-auto text-xs font-mono leading-relaxed shadow-inner\">\r\n                                {JSON.stringify(response, null, 2)}\r\n                            </pre>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction TabsSection({ result }: { result: NoteExtractResult }) {\r\n    const [activeTab, setActiveTab] = useState<'problems' | 'medications' | 'allergies' | 'followUps'>('problems');\r\n\r\n    const tabs = [\r\n        { id: 'problems', label: 'Problems', icon: Activity, count: result.problems.length },\r\n        { id: 'medications', label: 'Medications', icon: Pill, count: result.medications.length },\r\n        { id: 'allergies', label: 'Allergies', icon: AlertTriangle, count: result.allergies.length },\r\n        { id: 'followUps', label: 'Follow Up', icon: Calendar, count: result.followUps.length },\r\n    ];\r\n\r\n    const activeList = result[activeTab];\r\n\r\n    return (\r\n        <div className=\"bg-white rounded-3xl border border-slate-200 shadow-sm overflow-hidden flex flex-col min-h-[400px]\">\r\n            <div className=\"flex bg-slate-50 border-b border-slate-100 overflow-x-auto scroller-hide\">\r\n                {tabs.map((tab) => (\r\n                    <button\r\n                        key={tab.id}\r\n                        onClick={() => setActiveTab(tab.id as any)}\r\n                        className={`flex items-center gap-3 px-8 py-5 text-sm font-bold transition-all relative min-w-fit ${activeTab === tab.id ? 'text-indigo-600 bg-white' : 'text-slate-400 hover:text-slate-600'\r\n                            }`}\r\n                    >\r\n                        <tab.icon className={`h-4 w-4 ${activeTab === tab.id ? 'text-indigo-600' : 'text-slate-400'}`} />\r\n                        {tab.label}\r\n                        <span className={`px-2 py-0.5 rounded-full text-[11px] ${activeTab === tab.id ? 'bg-indigo-100 text-indigo-700' : 'bg-slate-200 text-slate-500'\r\n                            }`}>\r\n                            {tab.count}\r\n                        </span>\r\n                        {activeTab === tab.id && (\r\n                            <div className=\"absolute bottom-[-1px] left-0 right-0 h-1 bg-indigo-600\" />\r\n                        )}\r\n                    </button>\r\n                ))}\r\n            </div>\r\n\r\n            <div className=\"p-8 flex-1\">\r\n                {activeList.length === 0 ? (\r\n                    <div className=\"h-full flex flex-col items-center justify-center text-slate-400 gap-4 py-12\">\r\n                        <CheckCircle2 className=\"h-12 w-12 text-slate-100\" />\r\n                        <p className=\"font-semibold text-lg\">No {activeTab} identified.</p>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 animate-in fade-in duration-300\">\r\n                        {activeList.map((item, idx) => (\r\n                            <div key={idx} className=\"group bg-slate-50 p-6 rounded-2xl border border-slate-100 hover:border-indigo-200 hover:bg-white transition-all\">\r\n                                <div className=\"flex items-center gap-3 mb-3\">\r\n                                    <div className=\"h-2 w-2 rounded-full bg-indigo-500 group-hover:scale-150 transition-transform\" />\r\n                                    <h4 className=\"font-bold text-slate-900 group-hover:text-indigo-700 transition-colors\">\r\n                                        {item.label}\r\n                                    </h4>\r\n                                </div>\r\n                                <p className=\"text-sm text-slate-500 italic flex gap-2\">\r\n                                    <ArrowRight className=\"h-3.5 w-3.5 mt-0.5 flex-shrink-0 text-slate-400\" />\r\n                                    <span>{item.evidence}</span>\r\n                                </p>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Atharv\\Git\\careflow\\careflow-copilot\\app\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Atharv\\Git\\careflow\\careflow-copilot\\components\\ui\\card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Atharv\\Git\\careflow\\careflow-copilot\\eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Atharv\\Git\\careflow\\careflow-copilot\\lib\\fhir\\file-discovery.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Atharv\\Git\\careflow\\careflow-copilot\\lib\\fhir\\forecast.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Atharv\\Git\\careflow\\careflow-copilot\\lib\\fhir\\metrics.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1300,1303],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1300,1303],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":98,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3645,3648],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3645,3648],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Atharv\\Git\\careflow\\careflow-copilot\\lib\\fhir\\ndjson.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Atharv\\Git\\careflow\\careflow-copilot\\lib\\llm\\prompt.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Atharv\\Git\\careflow\\careflow-copilot\\lib\\llm\\schema.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Atharv\\Git\\careflow\\careflow-copilot\\lib\\obs\\tracing.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Atharv\\Git\\careflow\\careflow-copilot\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Atharv\\Git\\careflow\\careflow-copilot\\next.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Atharv\\Git\\careflow\\careflow-copilot\\postcss.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Atharv\\Git\\careflow\\careflow-copilot\\scripts\\check-derived.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Atharv\\Git\\careflow\\careflow-copilot\\scripts\\derive.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Atharv\\Git\\careflow\\careflow-copilot\\scripts\\smoke-llm.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Atharv\\Git\\careflow\\careflow-copilot\\scripts\\smoke-ndjson.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1584,1587],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1584,1587],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Atharv\\Git\\careflow\\careflow-copilot\\scripts\\validate.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Atharv\\Git\\careflow\\careflow-copilot\\scripts\\verify.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":11,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { execSync } from \"child_process\";\r\n\r\nfunction verify() {\r\n    try {\r\n        console.log(\"Running full local verification...\");\r\n        execSync(\"npm run data:build\", { stdio: \"inherit\" });\r\n        execSync(\"npm run data:check\", { stdio: \"inherit\" });\r\n        execSync(\"npm run lint\", { stdio: \"inherit\" });\r\n        execSync(\"npm run build\", { stdio: \"inherit\" });\r\n        console.log(\"OK\");\r\n    } catch (error) {\r\n        console.error(\"Verification failed\");\r\n        process.exit(1);\r\n    }\r\n}\r\n\r\nverify();\r\n","usedDeprecatedRules":[]}]